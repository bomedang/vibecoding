<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God Knight: ì´ëª¨ì§€ ë°©ì¹˜í˜• RPG</title>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --accent: #e94560;
            --text: #ffffff;
            --gold: #f9d71c;
        }
        body {
            font-family: 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            user-select: none;
            overflow: hidden;
        }
        .container {
            width: 100%;
            max-width: 400px;
            text-align: center;
            padding: 20px;
        }
        
        /* ìƒë‹¨ ì •ë³´ */
        .header {
            display: flex;
            justify-content: space-between;
            background: var(--card-bg);
            padding: 10px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .stat-box { font-size: 1.1rem; font-weight: bold; }
        .gold-text { color: var(--gold); }

        /* ì „íˆ¬ í™”ë©´ */
        .battle-stage {
            position: relative;
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .level-badge {
            background: var(--accent);
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .characters {
            display: flex;
            align-items: center;
            justify-content: space-around;
            width: 100%;
            font-size: 4rem;
        }
        .knight { cursor: default; }
        .monster { 
            cursor: pointer; 
            transition: transform 0.1s;
        }
        .monster:active { transform: scale(0.9); }
        .shake { animation: shake 0.3s; }
        
        /* ì²´ë ¥ë°” */
        .hp-container {
            width: 80%;
            height: 15px;
            background: #333;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
            border: 2px solid #555;
        }
        .hp-bar {
            width: 100%;
            height: 100%;
            background: #ff4757;
            transition: width 0.2s;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .btn {
            background: var(--card-bg);
            border: 2px solid #444;
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        .btn:hover { background: #1f2b4d; border-color: var(--accent); }
        .btn:active { transform: translateY(2px); }
        .btn-icon { font-size: 1.5rem; margin-right: 10px; }
        .btn-cost { color: var(--gold); font-size: 0.9rem; }
        
        /* ìœ í‹¸ ë²„íŠ¼ */
        .utils { margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        .small-btn { padding: 8px 15px; background: #333; border: none; color: #aaa; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }

        /* ë°ë¯¸ì§€ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
        .damage-text {
            position: absolute;
            color: #fff;
            font-weight: bold;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            text-shadow: 2px 2px 0 #000;
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="stat-box">ğŸ’° <span id="ui-gold" class="gold-text">0</span></div>
        <div class="stat-box">âš”ï¸ <span id="ui-dps">0</span> DPS</div>
    </div>

    <div class="battle-stage">
        <div class="level-badge">STAGE <span id="ui-stage">1</span></div>
        <div class="characters">
            <div class="knight">ğŸ›¡ï¸</div>
            <div class="monster" id="monster" onclick="playerClick()">ğŸ‘¾</div>
        </div>
        <div class="hp-container">
            <div class="hp-bar" id="ui-hp"></div>
        </div>
        <div style="margin-top: 5px; font-size: 0.8rem;">
            HP: <span id="ui-hp-text">10/10</span>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="upgrade('atk')">
            <div>
                <span class="btn-icon">ğŸ—¡ï¸</span> ê°•í™” (ê³µê²©ë ¥ +1)
            </div>
            <div class="btn-cost">ğŸ’° <span id="cost-atk">10</span></div>
        </button>
        <button class="btn" onclick="upgrade('auto')">
            <div>
                <span class="btn-icon">ğŸ¤–</span> ë™ë£Œ ê³ ìš© (ì´ˆë‹¹ ê³µê²©)
            </div>
            <div class="btn-cost">ğŸ’° <span id="cost-auto">50</span></div>
        </button>
        <button class="btn" onclick="upgrade('crit')">
            <div>
                <span class="btn-icon">âš¡</span> ì¹˜ëª…íƒ€ (í™•ë¥  UP)
            </div>
            <div class="btn-cost">ğŸ’° <span id="cost-crit">100</span></div>
        </button>
    </div>

    <div class="utils">
        <button class="small-btn" onclick="saveGame(true)">ğŸ’¾ ê°•ì œ ì €ì¥</button>
        <button class="small-btn" onclick="resetGame()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
    </div>
</div>

<script>
    // --- ê²Œì„ ë°ì´í„° ë° ì„¤ì • ---
    const SECRET_KEY = "GOD_KNIGHT_SECRET"; // ì•”í˜¸í™” í‚¤
    let game = {
        gold: 0,
        stage: 1,
        atk: 1,
        autoAtk: 0,
        critChance: 0, // %
        cost: {
            atk: 10,
            auto: 50,
            crit: 100
        }
    };

    // ëª¬ìŠ¤í„° ìƒíƒœ (ì €ì¥ ì•ˆ í•¨)
    let monster = {
        hp: 10,
        maxHp: 10,
        emoji: 'ğŸ‘¾'
    };
    
    const monsterEmojis = ['ğŸ‘¾', 'ğŸ¦‡', 'ğŸº', 'ğŸ’€', 'ğŸ‘¹', 'ğŸ§›', 'ğŸ§Ÿ', 'ğŸ‰', 'ğŸ™', 'ğŸ¦–'];

    // --- ì•”í˜¸í™” ë° ì¿ í‚¤ ì‹œìŠ¤í…œ ---
    
    // ê°„ë‹¨í•œ XOR ì•”í˜¸í™” + Base64
    function encrypt(text) {
        let result = '';
        for(let i = 0; i < text.length; i++) {
            result += String.fromCharCode(text.charCodeAt(i) ^ SECRET_KEY.charCodeAt(i % SECRET_KEY.length));
        }
        return btoa(result);
    }

    function decrypt(cipher) {
        try {
            let text = atob(cipher);
            let result = '';
            for(let i = 0; i < text.length; i++) {
                result += String.fromCharCode(text.charCodeAt(i) ^ SECRET_KEY.charCodeAt(i % SECRET_KEY.length));
            }
            return result;
        } catch (e) {
            return null;
        }
    }

    function saveGame(alertUser = false) {
        const json = JSON.stringify(game);
        const encryptedData = encrypt(json);
        // ì¿ í‚¤ ë§Œë£Œì¼ 1ë…„
        document.cookie = `godKnightSave=${encryptedData}; path=/; max-age=31536000`;
        if (alertUser) alert("ê²Œì„ì´ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¾");
    }

    function loadGame() {
        const cookies = document.cookie.split(';');
        let saveData = null;
        
        for(let cookie of cookies) {
            cookie = cookie.trim();
            if(cookie.startsWith("godKnightSave=")) {
                saveData = cookie.substring("godKnightSave=".length);
                break;
            }
        }

        if(saveData) {
            const json = decrypt(saveData);
            if(json) {
                const loaded = JSON.parse(json);
                game = { ...game, ...loaded }; // ë³‘í•©
                spawnMonster(false); // ë¡œë“œ ì‹œ ëª¬ìŠ¤í„° ì²´ë ¥ ì¬ì„¤ì •
            }
        }
        updateUI();
    }

    function resetGame() {
        if(confirm("ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            document.cookie = "godKnightSave=; path=/; max-age=0";
            location.reload();
        }
    }

    // --- ê²Œì„ ë¡œì§ ---

    function spawnMonster(nextLevel = true) {
        if (nextLevel) {
            // ì²´ë ¥ ê³µì‹: ê¸°ë³¸ 10 * 1.2^ìŠ¤í…Œì´ì§€
            monster.maxHp = Math.floor(10 * Math.pow(1.2, game.stage - 1));
        }
        monster.hp = monster.maxHp;
        // 10ìŠ¤í…Œì´ì§€ë§ˆë‹¤ ëª¬ìŠ¤í„° ì™¸í˜• ë³€ê²½
        const emojiIndex = Math.min(Math.floor((game.stage - 1) / 5), monsterEmojis.length - 1);
        monster.emoji = monsterEmojis[emojiIndex];
        
        document.getElementById('monster').innerText = monster.emoji;
        updateUI();
    }

    function hitMonster(dmg, isAuto = false) {
        // ì¹˜ëª…íƒ€ ê³„ì‚°
        let finalDmg = dmg;
        let isCrit = false;
        if (!isAuto && Math.random() * 100 < game.critChance) {
            finalDmg *= 2;
            isCrit = true;
        }

        monster.hp -= finalDmg;
        
        // ì‹œê° íš¨ê³¼
        if (!isAuto) {
            const monsterEl = document.getElementById('monster');
            monsterEl.classList.remove('shake');
            void monsterEl.offsetWidth; // ë¦¬í”Œë¡œìš° ê°•ì œ
            monsterEl.classList.add('shake');
            showDamageText(finalDmg, isCrit);
        }

        if (monster.hp <= 0) {
            // ëª¬ìŠ¤í„° ì²˜ì¹˜
            const reward = Math.floor(game.stage * (Math.random() * 2 + 1)); // 1~3ë°° ê³¨ë“œ
            game.gold += reward;
            game.stage++;
            spawnMonster(true);
            saveGame(); // ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì‹œ ìë™ ì €ì¥
        }
        updateUI();
    }

    function playerClick() {
        hitMonster(game.atk);
    }

    function upgrade(type) {
        if (type === 'atk') {
            if (game.gold >= game.cost.atk) {
                game.gold -= game.cost.atk;
                game.atk += 1;
                game.cost.atk = Math.floor(game.cost.atk * 1.3);
            }
        } else if (type === 'auto') {
            if (game.gold >= game.cost.auto) {
                game.gold -= game.cost.auto;
                game.autoAtk += 1; // ì´ˆë‹¹ +1 ë°ë¯¸ì§€
                game.cost.auto = Math.floor(game.cost.auto * 1.5);
            }
        } else if (type === 'crit') {
            if (game.gold >= game.cost.crit) {
                game.gold -= game.cost.crit;
                game.critChance += 1; // 1% ì¦ê°€
                game.cost.crit = Math.floor(game.cost.crit * 1.5);
            }
        }
        updateUI();
        saveGame();
    }

    // --- UI ì—…ë°ì´íŠ¸ ---
    function updateUI() {
        document.getElementById('ui-gold').innerText = game.gold.toLocaleString();
        document.getElementById('ui-stage').innerText = game.stage;
        document.getElementById('ui-dps').innerText = game.autoAtk;
        
        // ëª¬ìŠ¤í„° ì²´ë ¥ë°”
        const hpPercent = Math.max(0, (monster.hp / monster.maxHp) * 100);
        document.getElementById('ui-hp').style.width = hpPercent + "%";
        document.getElementById('ui-hp-text').innerText = `${Math.ceil(monster.hp)} / ${monster.maxHp}`;

        // ë²„íŠ¼ ê°€ê²© ì—…ë°ì´íŠ¸
        document.getElementById('cost-atk').innerText = game.cost.atk;
        document.getElementById('cost-auto').innerText = game.cost.auto;
        document.getElementById('cost-crit').innerText = game.cost.crit;
    }

    function showDamageText(dmg, isCrit) {
        const stage = document.querySelector('.battle-stage');
        const text = document.createElement('div');
        text.className = 'damage-text';
        text.innerText = dmg;
        
        if (isCrit) {
            text.style.color = '#ffeb3b';
            text.style.fontSize = '2rem';
            text.innerText += "!";
        }

        // ëœë¤ ìœ„ì¹˜ ì•½ê°„ ì¡°ì •
        const randomX = (Math.random() - 0.5) * 50;
        text.style.transform = `translateX(${randomX}px)`;
        
        stage.appendChild(text);
        setTimeout(() => text.remove(), 800);
    }

    // --- ë©”ì¸ ë£¨í”„ ---
    setInterval(() => {
        if (game.autoAtk > 0) {
            // ì´ˆë‹¹ ë°ë¯¸ì§€ë¥¼ 10ë¶„í• í•´ì„œ 0.1ì´ˆë§ˆë‹¤ ì ìš© (ë¶€ë“œëŸ½ê²Œ)
            hitMonster(game.autoAtk / 10, true);
        }
    }, 100);

    // ê²Œì„ ì‹œì‘
    loadGame();
    spawnMonster(false);

</script>

</body>
</html>
