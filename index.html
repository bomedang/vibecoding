<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- Firebase App (modular) CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
        // Firebase ì„¤ì • (ê¸°ì¡´ ê°’ ì‚¬ìš©)
        const firebaseConfig = {
            apiKey: "AIzaSyDpcOJfXhipqXWYAvDaQpgFSFzq9N5IT5c",
            authDomain: "testing123-bbda8.firebaseapp.com",
            databaseURL: "https://testing123-bbda8-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "testing123-bbda8",
            storageBucket: "testing123-bbda8.appspot.com",
            messagingSenderId: "511649892672",
            appId: "1:511649892672:web:3f976bd9fc68aefb9852a5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        window.registerOnlineUser = function (uid, nickname, email, isAdmin) {
            db.ref('onlineUsers/' + uid).set({
                nickname, email, isAdmin, lastActive: Date.now()
            });
        };
        window.subscribeOnlineUsers = function (cb) {
            db.ref('onlineUsers').on('value', snap => {
                const val = snap.val() || {};
                cb(Object.values(val));
            });
        };
        window.sendAdminNotice = function (msg) {
            db.ref('adminNotice').set({ msg, ts: Date.now() });
        };
        window.subscribeAdminNotice = function (cb) {
            db.ref('adminNotice').on('value', snap => {
                const val = snap.val();
                if (val) cb(val.msg, val.ts);
            });
        };
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¢…í•© ê²Œì„</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #232946;
            color: #fff;
            margin: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 40px auto;
            background: #16161a;
            border-radius: 16px;
            padding: 32px 24px;
            box-shadow: 0 4px 24px #0002;
        }

        h1 {
            text-align: center;
            margin-bottom: 32px;
        }

        .g_id_signin {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        #user-info {
            text-align: center;
            margin-bottom: 24px;
        }

        .main-menu {
            display: flex;
            justify-content: space-around;
            margin: 32px 0;
        }

        .main-menu button {
            background: #eebbc3;
            color: #232946;
            border: none;
            border-radius: 8px;
            padding: 18px 32px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .main-menu button:hover {
            background: #ffd6e0;
        }

        .currency {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 24px 0 0 0;
            font-size: 18px;
            gap: 8px;
        }

        .currency-table-btn {
            background: none;
            border: none;
            margin-left: 6px;
            padding: 4px 8px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            font-size: 20px;
            color: #eebbc3;
        }

        .currency-table-btn:hover {
            background: #eebbc3;
            color: #232946;
        }

        .currency-table-modal {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .currency-table-content {
            background: #fff;
            color: #232946;
            border-radius: 18px;
            padding: 36px 32px 28px 32px;
            min-width: 340px;
            box-shadow: 0 8px 32px #0004;
            position: relative;
            animation: popIn 0.2s;
        }

        @keyframes popIn {
            0% {
                transform: scale(0.9);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .currency-table-content h3 {
            margin-top: 0;
            text-align: center;
            font-size: 1.3em;
            letter-spacing: 1px;
        }

        .currency-table-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 1em;
        }

        .currency-table-content th,
        .currency-table-content td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }

        .currency-table-content th {
            background: #eebbc3;
            color: #232946;
            font-weight: bold;
        }

        .currency-table-content tr:last-child td {
            border-bottom: none;
        }

        .currency-table-close {
            position: absolute;
            top: 12px;
            right: 16px;
            background: none;
            border: none;
            font-size: 26px;
            color: #232946;
            cursor: pointer;
            transition: color 0.2s;
        }

        .currency-table-close:hover {
            color: #eebbc3;
        }

        .section {
            display: none;
            margin-top: 32px;
        }

        .section.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ® ì¢…í•© ê²Œì„</h1>
        <div id="g_id_onload" data-client_id="511649892672-g9lat13ukjti5buvmc6ojj87n1mcu52n.apps.googleusercontent.com"
            data-callback="onGoogleSignIn" data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard"></div>
        <div id="user-info" style="display:none;"></div>
        <div class="currency" id="currencyRow" style="display:none;">
            <span id="currencyDisplay"></span>
            <button class="currency-table-btn" id="showCurrencyTableBtn" title="ì œí™” ê¸°ì¤€í‘œ ë³´ê¸°">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <line x1="12" y1="16" x2="12" y2="12" />
                    <line x1="12" y1="8" x2="12" y2="8" />
                </svg>
            </button>
        </div>
        <div class="currency-table-modal" id="currencyTableModal">
            <div class="currency-table-content">
                <button class="currency-table-close" id="closeCurrencyTable">Ã—</button>
                <h3>ì œí™” ë‹¨ìœ„ ê¸°ì¤€í‘œ</h3>
                <table>
                    <tr>
                        <th>ë‹¨ìœ„</th>
                        <th>ë³€í™˜ ê¸°ì¤€</th>
                    </tr>
                    <tr>
                        <td>ë£¨í”„ (Loop)</td>
                        <td>ê°€ì¥ ì‘ì€ ì œí™”</td>
                    </tr>
                    <tr>
                        <td>ì‚¬ì¸ (Sign)</td>
                        <td>1 ì‚¬ì¸ = 1,000 ë£¨í”„</td>
                    </tr>
                    <tr>
                        <td>ê´‘ (å…‰)</td>
                        <td>1 ê´‘ = 1,000 ì‚¬ì¸</td>
                    </tr>
                    <tr>
                        <td>ì„±</td>
                        <td>1 ì„± = 1,000 ê´‘</td>
                    </tr>
                    <tr>
                        <td>ì²œ (å¤©)</td>
                        <td>1 ì²œ = 1,000 ì„±</td>
                    </tr>
                    <tr>
                        <td>í•µ (æ ¸)</td>
                        <td>1 í•µ = 1,000 ì²œ</td>
                    </tr>
                    <tr>
                        <td>ì œë„¤ì‹œìŠ¤ (Genesis)</td>
                        <td>1 ì œë„¤ì‹œìŠ¤ = 1,000 í•µ</td>
                    </tr>
                    <tr>
                        <td>ì˜</td>
                        <td>1 ì˜ = 1,000 ì œë„¤ì‹œìŠ¤</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="main-menu" id="mainMenu" style="display:none;">
            <button onclick="showSection('shop')">ìƒì </button>
            <button onclick="showSection('minigame')">ë¯¸ë‹ˆê²Œì„</button>
            <button onclick="showSection('chat')">ì±„íŒ…</button>
        </div>
        <div id="shop" class="section">
            <h2>ìƒì </h2>
            <p>ì•„ì´í…œ êµ¬ë§¤ ê¸°ëŠ¥ ì˜ˆì •</p>
        </div>
        <div id="minigame" class="section">
            <h2>ë¯¸ë‹ˆê²Œì„</h2>
            <div id="minigame-menu" style="margin-bottom:20px; display:flex; gap:12px;">
                <button onclick="showMiniGame('tictactoe')"
                    style="padding:8px 18px; border-radius:8px; border:none; background:#eebbc3; color:#232946; font-weight:bold; cursor:pointer;">í‹±íƒí† </button>
                <button onclick="showMiniGame('comingsoon')"
                    style="padding:8px 18px; border-radius:8px; border:none; background:#b8c1ec; color:#232946; font-weight:bold; cursor:pointer;">ë‹¤ë¥¸
                    ë¯¸ë‹ˆê²Œì„</button>
            </div>
            <div id="tictactoe-game" style="display:none;">
                <h3 style="margin-bottom:10px;">í‹±íƒí† </h3>
                <div style="display:flex; gap:32px; justify-content:center; align-items:flex-start;">
                    <div>
                        <div id="tictactoe-board"
                            style="display:grid; grid-template-columns:repeat(3,60px); grid-gap:8px; justify-content:center; margin-bottom:12px;">
                        </div>
                        <div id="tictactoe-status" style="text-align:center; margin-bottom:10px;"></div>
                        <button id="tictactoe-restart"
                            style="display:none; margin:0 auto; padding:6px 18px; border-radius:8px; border:none; background:#eebbc3; color:#232946; font-weight:bold; cursor:pointer;">ë‹¤ì‹œí•˜ê¸°</button>
                    </div>
                    <div style="min-width:180px;">
                        <div style="font-weight:bold; margin-bottom:8px; text-align:center;">ì˜¨ë¼ì¸ ìœ ì €</div>
                        <div id="online-user-list"
                            style="background:#fff; color:#232946; border-radius:8px; min-height:120px; padding:10px 8px; font-size:15px; max-height:200px; overflow-y:auto;">
                        </div>
                    </div>
                </div>
            </div>
            <div id="comingsoon-game" style="display:none; text-align:center; color:#aaa;">
                <h3>ë‹¤ë¥¸ ë¯¸ë‹ˆê²Œì„</h3>
                <p>ì¶”ê°€ ë¯¸ë‹ˆê²Œì„ì€ ê³§ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤!</p>
            </div>
        </div>
        <div id="chat" class="section">
            <h2>ì±„íŒ…</h2>
            <p>ì±„íŒ… ê¸°ëŠ¥ ì˜ˆì •</p>
        </div>
    </div>
    <script>
        // ì–´ë“œë¯¼ ì—¬ë¶€ ì²´í¬(ì´ë©”ì¼ ê¸°ë°˜, ì‹¤ì œ ì„œë¹„ìŠ¤ëŠ” custom claim ê¶Œì¥)
        function isAdminEmail(email) {
            // ì—¬ê¸°ì— ì–´ë“œë¯¼ ì´ë©”ì¼ ì¶”ê°€
            return email === 'leeprefer10272@gmail.com';
        }
        // --- ì˜¨ë¼ì¸ ìœ ì €/ë§¤ì¹­ ìƒ˜í”Œ êµ¬ì¡° ---
        let onlineUsers = [];
        let myEmail = null;
        let myNickname = null;
        let myUid = null;
        let isAdmin = false;
        // í‹±íƒí†  ì§„ì… ì‹œ ì˜¨ë¼ì¸ ìœ ì € ëª©ë¡ í‘œì‹œ
        function updateOnlineUserList() {
            const listDiv = document.getElementById('online-user-list');
            if (!myEmail) { listDiv.innerHTML = '<span style="color:#aaa;">ë¡œê·¸ì¸ í•„ìš”</span>'; return; }
            const filtered = onlineUsers.filter(u => u.email !== myEmail);
            if (filtered.length === 0) { listDiv.innerHTML = '<span style="color:#aaa;">ìƒëŒ€ ì—†ìŒ</span>'; return; }
            listDiv.innerHTML = filtered.map(u =>
                `<div style='display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;'>
                    <span>${u.nickname || u.name}</span>
                    <button style='padding:2px 8px;border-radius:6px;border:none;background:#b8c1ec;color:#232946;cursor:pointer;font-size:0.95em;' onclick='requestTicTacToeMatch("${u.email}")'>ë§¤ì¹­</button>
                </div>`
            ).join('');
        }
        // ë§¤ì¹­ ì‹ ì²­
        function requestTicTacToeMatch(targetEmail) {
            alert(targetEmail + 'ë‹˜ì—ê²Œ ë§¤ì¹­ ì‹ ì²­! (ì‹¤ì œ êµ¬í˜„ì€ firebaseë¡œ ì „ì†¡)');
            // ì‹¤ì œ êµ¬í˜„: firebaseì— ë§¤ì¹­ ìš”ì²­ ê¸°ë¡
        }
        // ë¯¸ë‹ˆê²Œì„ ë©”ë‰´/í‹±íƒí† 
        function showMiniGame(name) {
            document.getElementById('tictactoe-game').style.display = (name === 'tictactoe') ? 'block' : 'none';
            document.getElementById('comingsoon-game').style.display = (name === 'comingsoon') ? 'block' : 'none';
            if (name === 'tictactoe') {
                // êµ¬ê¸€ credentialì—ì„œ uid/email/nickname ì¶”ì¶œ
                const cred = localStorage.getItem('google_credential');
                if (!cred) return;
                const payload = JSON.parse(atob(cred.split('.')[1]));
                myEmail = payload.email;
                myUid = payload.sub;
                myNickname = getNickname(myEmail) || payload.name;
                isAdmin = isAdminEmail(myEmail);
                // ì˜¨ë¼ì¸ ìœ ì € ë“±ë¡
                window.registerOnlineUser(myUid, myNickname, myEmail, isAdmin);
                // ì‹¤ì‹œê°„ ì˜¨ë¼ì¸ ìœ ì € ëª©ë¡ êµ¬ë…
                window.subscribeOnlineUsers(function (users) {
                    onlineUsers = users;
                    updateOnlineUserList();
                });
                // ì‹¤ì‹œê°„ ì „ì²´ ê³µì§€ êµ¬ë…
                window.subscribeAdminNotice(function (msg, ts) {
                    if (msg) alert('[ì „ì²´ê³µì§€] ' + msg);
                });
                updateOnlineUserList();
                initTicTacToe();
                // ì–´ë“œë¯¼ ê¸°ëŠ¥ UI í‘œì‹œ
                document.getElementById('admin-feature-panel').style.display = isAdmin ? 'block' : 'none';
            }
            <div id="admin-feature-panel" style="display:none; margin-bottom:12px; text-align:center;">
                <input id="adminNoticeInput" type="text" placeholder="ì „ì²´ ê³µì§€ ì…ë ¥" style="padding:6px 12px; border-radius:6px; border:1px solid #b8c1ec; width:60%;">
                    <button onclick="window.sendAdminNotice(document.getElementById('adminNoticeInput').value)" style="padding:6px 16px; border-radius:8px; border:none; background:#eebbc3; color:#232946; font-weight:bold; cursor:pointer;">ì „ì²´ê³µì§€ ì „ì†¡</button>
            </div>
        }

        // í‹±íƒí†  ê²Œì„ ë¡œì§
        let tttBoard, tttTurn, tttOver;
        function initTicTacToe() {
            tttBoard = Array(9).fill('');
            tttTurn = 'X';
            tttOver = false;
            renderTicTacToe();
            document.getElementById('tictactoe-status').innerText = 'í”Œë ˆì´ì–´ X ì°¨ë¡€';
            document.getElementById('tictactoe-restart').style.display = 'none';
        }
        function renderTicTacToe() {
            const boardDiv = document.getElementById('tictactoe-board');
            boardDiv.innerHTML = '';
            tttBoard.forEach((cell, i) => {
                const btn = document.createElement('button');
                btn.style.width = '60px';
                btn.style.height = '60px';
                btn.style.fontSize = '2em';
                btn.style.background = '#fff';
                btn.style.color = '#232946';
                btn.style.border = '2px solid #b8c1ec';
                btn.style.borderRadius = '10px';
                btn.style.cursor = cell || tttOver ? 'default' : 'pointer';
                btn.innerText = cell;
                btn.disabled = !!cell || tttOver;
                btn.onclick = function () { if (!tttOver && !cell) ticTacToeMove(i); };
                boardDiv.appendChild(btn);
            });
        }
        function ticTacToeMove(idx) {
            if (tttBoard[idx] || tttOver) return;
            tttBoard[idx] = tttTurn;
            renderTicTacToe();
            if (checkTicTacToeWin(tttTurn)) {
                document.getElementById('tictactoe-status').innerText = `í”Œë ˆì´ì–´ ${tttTurn} ìŠ¹ë¦¬!`;
                tttOver = true;
                document.getElementById('tictactoe-restart').style.display = 'block';
                return;
            }
            if (tttBoard.every(cell => cell)) {
                document.getElementById('tictactoe-status').innerText = 'ë¬´ìŠ¹ë¶€!';
                tttOver = true;
                document.getElementById('tictactoe-restart').style.display = 'block';
                return;
            }
            tttTurn = tttTurn === 'X' ? 'O' : 'X';
            document.getElementById('tictactoe-status').innerText = `í”Œë ˆì´ì–´ ${tttTurn} ì°¨ë¡€`;
        }
        function checkTicTacToeWin(turn) {
            const winIdx = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];
            return winIdx.some(line => line.every(i => tttBoard[i] === turn));
        }
        document.getElementById('tictactoe-restart').onclick = initTicTacToe;
        // í˜ì´ì§€ ì§„ì… ì‹œ ëª¨ë‹¬ í•­ìƒ ìˆ¨ê¹€ ë° ìë™ë¡œê·¸ì¸ ì‹œë„
        window.onload = function () {
            document.getElementById('currencyTableModal').style.display = 'none';
            // ìë™ë¡œê·¸ì¸ ì‹œë„
            const savedCredential = localStorage.getItem('google_credential');
            if (savedCredential) {
                // êµ¬ê¸€ One Tap credential êµ¬ì¡°ì™€ ë™ì¼í•˜ê²Œ ê°€ì§œ response ê°ì²´ ìƒì„±
                onGoogleSignIn({ credential: savedCredential });
            }
        };

        // í•œê¸€ ì´ë¦„ ê¹¨ì§ ë°©ì§€ìš©(UTF-8 ë””ì½”ë”©)
        function decodeJwtName(str) {
            try {
                return decodeURIComponent(escape(str));
            } catch { return str; }
        }
        // ë‹‰ë„¤ì„ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (localStorage)
        function getNickname(email) {
            return localStorage.getItem('nickname_' + email) || '';
        }
        function setNickname(email, nick) {
            localStorage.setItem('nickname_' + email, nick);
        }
        // êµ¬ê¸€ ë¡œê·¸ì¸ ì½œë°±
        function onGoogleSignIn(response) {
            const credential = response.credential;
            // ìë™ë¡œê·¸ì¸ìš© credential ì €ì¥
            localStorage.setItem('google_credential', credential);
            const payload = JSON.parse(atob(credential.split('.')[1]));
            const name = decodeJwtName(payload.name);
            const email = payload.email;
            let nickname = getNickname(email);
            let nickHtml = '';
            if (nickname) {
                nickHtml = `<b>${nickname}</b> <span style='color:#aaa;font-size:0.95em;'>(${name}, ${email})</span>`;
            } else {
                nickHtml = `<b>${name}</b> (${email}) <button id='setNickBtn' style='margin-left:8px;padding:2px 10px;font-size:0.95em;border-radius:6px;border:none;background:#eebbc3;color:#232946;cursor:pointer;'>ë‹‰ë„¤ì„ ì„¤ì •</button>`;
            }
            document.getElementById('user-info').innerHTML = nickHtml + " <button onclick='logout()' style='margin-left:10px;'>ë¡œê·¸ì•„ì›ƒ</button>";
            document.getElementById('user-info').style.display = 'block';
            document.querySelector('.g_id_signin').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'flex';
            document.getElementById('currencyRow').style.display = 'flex';
            // ì„ì‹œ: ë¡œê·¸ì¸ ì‹œ ë³´ìœ  ì œí™” í‘œì‹œ(ìƒ˜í”Œ)
            updateCurrencyDisplay(1234567890123);
            // ì œí™” ê¸°ì¤€í‘œ ë²„íŠ¼/ëª¨ë‹¬ ë™ì‘
            document.getElementById('showCurrencyTableBtn').onclick = function () {
                document.getElementById('currencyTableModal').style.display = 'flex';
            };
            document.getElementById('closeCurrencyTable').onclick = function () {
                document.getElementById('currencyTableModal').style.display = 'none';
            };
            // ë‹‰ë„¤ì„ ì„¤ì • ë²„íŠ¼ ì´ë²¤íŠ¸
            setTimeout(() => {
                const btn = document.getElementById('setNickBtn');
                if (btn) {
                    btn.onclick = function () {
                        const newNick = prompt('ì‚¬ìš©í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 12ì)', name);
                        if (newNick && newNick.length <= 12) {
                            setNickname(email, newNick);
                            onGoogleSignIn(response); // ìƒˆë¡œê³ ì¹¨
                        } else if (newNick) {
                            alert('ë‹‰ë„¤ì„ì€ 12ì ì´í•˜ë¡œ ì…ë ¥í•˜ì„¸ìš”.');
                        }
                    };
                }
            }, 100);
        }
        function logout() {
            localStorage.removeItem('google_credential');
            location.reload();
        }
        // ë©”ë‰´ ì „í™˜
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(section).classList.add('active');
        }
        // ì œí™” ë‹¨ìœ„ ë³€í™˜ í•¨ìˆ˜
        function formatCurrency(amount) {
            const units = [
                { name: 'ì˜', value: 1e24 },
                { name: 'ì œë„¤ì‹œìŠ¤', value: 1e21 },
                { name: 'í•µ', value: 1e18 },
                { name: 'ì²œ', value: 1e15 },
                { name: 'ì„±', value: 1e12 },
                { name: 'ê´‘', value: 1e9 },
                { name: 'ì‚¬ì¸', value: 1e6 },
                { name: 'ë£¨í”„', value: 1 }
            ];
            let result = [];
            let remaining = amount;
            for (let unit of units) {
                if (remaining >= unit.value) {
                    const count = Math.floor(remaining / unit.value);
                    result.push(`${count.toLocaleString()} ${unit.name}`);
                    remaining %= unit.value;
                }
            }
            return result.length > 0 ? result.join(' ') : '0 ë£¨í”„';
        }
        function updateCurrencyDisplay(amount) {
            document.getElementById('currencyDisplay').innerText = 'ë³´ìœ  ì œí™”: ' + formatCurrency(amount);
        }
    </script>
</body>

</html>
<!DOCTYPE html>


</html>
